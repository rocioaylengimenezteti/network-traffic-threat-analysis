<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Suspicious Traffic Analyzer</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    body {
        font-family: 'Roboto', sans-serif;
        margin: 0;
        background: #f4f6f8;
        color: #1a1a1a;
    }
    header {
        background: #0d47a1;
        color: #fff;
        padding: 1rem 2rem;
        text-align: center;
    }
    h1 {
        margin: 0;
        font-weight: 700;
    }
    main {
        padding: 2rem;
        max-width: 1200px;
        margin: auto;
    }
    input[type="file"] {
        display: block;
        margin: 1rem 0 2rem 0;
        font-size: 1rem;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 2rem;
        background: #fff;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    th, td {
        padding: 0.75rem 1rem;
        text-align: left;
        border-bottom: 1px solid #e0e0e0;
    }
    th {
        background: #0d47a1;
        color: #fff;
    }
    tr:hover {
        background: #e3f2fd;
    }
    .alerta-alta {
        background: #ffebee;
        color: #c62828;
        font-weight: 700;
    }
    .alerta-media {
        background: #fff3e0;
        color: #ef6c00;
        font-weight: 700;
    }
    canvas {
        margin-top: 2rem;
        background: #fff;
        border-radius: 8px;
        padding: 1rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    footer {
        text-align: center;
        margin: 2rem 0;
        color: #666;
    }
</style>
</head>
<body>
<header>
    <h1>Suspicious Traffic Analyzer - Expert Mode</h1>
    <p>Only critical packets and patterns are displayed, with explanations and recommended actions.</p>
</header>
<main>
    <input type="file" id="csvFile" accept=".csv" />
    <canvas id="graficoSospechoso" height="200"></canvas>
    <table id="tablaAlertas">
        <thead>
            <tr>
                <th># Packet</th>
                <th>Time</th>
                <th>Source IP</th>
                <th>Destination IP</th>
                <th>Source Port</th>
                <th>Destination Port</th>
                <th>Protocol</th>
                <th>Size</th>
                <th>Alert</th>
                <th>Explanation / Action</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</main>
<footer>
    Advanced analysis for cybersecurity companies. All rights reserved.
</footer>

<script>
document.getElementById('csvFile').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(event) {
        const text = event.target.result;
        analyzeCSV(text);
    };
    reader.readAsText(file);
});

function analyzeCSV(csvText) {
    const lines = csvText.trim().split('\n');
    const data = lines.map((line, idx) => {
        const [time, src_ip, dst_ip, src_port, dst_port, protocol, length] = line.split(',');
        return {index: idx+1, time, src_ip, dst_ip, src_port, dst_port, protocol, length: parseInt(length)};
    });

    const alerts = [];
    const suspiciousIPs = {};
    const suspiciousPorts = {};
    data.forEach(pkt => {
        let alert = '';
        let explanation = '';
        // Only mark critical anomalies
        if (!pkt.src_ip || !pkt.dst_ip) {
            alert = 'High';
            explanation = 'Missing source or destination IP → anomalous traffic, possible scanning or spoofing attempt.';
        } else if (pkt.length > 1000) {
            alert = 'High';
            explanation = 'Large packet size → possible data exfiltration or covert tunneling.';
        } else if (pkt.protocol.includes('TLS') || pkt.protocol.includes('HTTP')) {
            alert = 'Medium';
            explanation = 'Unusual secure protocol or suspicious HTTP traffic → potential data leakage.';
        } else if (pkt.protocol.includes('ICMP')) {
            alert = 'Medium';
            explanation = 'ICMP traffic → possible network reconnaissance.';
        }

        if (alert) {
            alerts.push({...pkt, alert, explanation});
        }
        // Count for charts
        if (pkt.src_ip) suspiciousIPs[pkt.src_ip] = (suspiciousIPs[pkt.src_ip]||0)+1;
        if (pkt.src_port) suspiciousPorts[pkt.src_port] = (suspiciousPorts[pkt.src_port]||0)+1;
    });
    // Display in table
    const tbody = document.querySelector('#tablaAlertas tbody');
    tbody.innerHTML = '';
    alerts.forEach(pkt => {
        const tr = document.createElement('tr');
        tr.className = pkt.alert === 'High' ? 'alerta-alta' : 'alerta-media';
        tr.innerHTML = `
            <td>${pkt.index}</td>
            <td>${pkt.time}</td>
            <td>${pkt.src_ip}</td>
            <td>${pkt.dst_ip}</td>
            <td>${pkt.src_port || ''}</td>
            <td>${pkt.dst_port || ''}</td>
            <td>${pkt.protocol}</td>
            <td>${pkt.length}</td>
            <td>${pkt.alert}</td>
            <td>${pkt.explanation}</td>
        `;
        tbody.appendChild(tr);
    });
    // Chart.js charts
    const ctx = document.getElementById('graficoSospechoso').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: Object.keys(suspiciousIPs),
            datasets: [{
                label: 'Suspicious packets by IP',
                data: Object.values(suspiciousIPs),
                backgroundColor: '#c62828'
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false },
                tooltip: { mode: 'index', intersect: false }
            },
            scales: {
                x: { title: { display: true, text: 'Source IP' } },
                y: { title: { display: true, text: 'Number of suspicious packets' }, beginAtZero: true }
            }
        }
    });
}
</script>
</body>
</html>

